# Python 类变量与实例变量详解

本文详细解析 Python 中类变量（class variables）与实例变量（instance variables）的区别，以及常见的陷阱和使用方法。

---

## 1. 基本示例

```python
class Dog:
    kind = 'canine'  # 类变量

    def __init__(self, name):
        self.name = name  # 实例变量


d = Dog('Fido')
e = Dog('Buddy')

print(d.kind, e.kind)  # canine canine
print(d.name, e.name)  # Fido Buddy
```

### 分析

- **类变量** `kind` 被所有实例共享。
- **实例变量** `name` 每个实例独立。

---

## 2. 可变对象作为类变量的坑

```python
class Dog:
    tricks = []  # 错误示范

    def __init__(self, name):
        self.name = name

    def add_trick(self, trick):
        self.tricks.append(trick)

d = Dog('Fido')
e = Dog('Buddy')
d.add_trick('roll over')
e.add_trick('play dead')
print(d.tricks)  # ['roll over', 'play dead']
```

**问题：**

- `tricks` 是类变量，所有实例共享同一个列表。
- 修改 `tricks` 会影响所有实例。

### 正确做法：实例变量

```python
class Dog:
    def __init__(self, name):
        self.name = name
        self.tricks = []  # 每个实例独立

    def add_trick(self, trick):
        self.tricks.append(trick)

d = Dog('Fido')
e = Dog('Buddy')
d.add_trick('roll over')
e.add_trick('play dead')
print(d.tricks)  # ['roll over']
print(e.tricks)  # ['play dead']
```

**总结：**

- 可变对象（列表、字典等）不要用作类变量，容易被共享，造成意外数据变化。

---

## 3. 类变量的修改方式

### 3.1 通过类名修改类变量（所有实例可见）

```python
class Dog:
    tricks = []  # 类变量

d = Dog()
e = Dog()

Dog.tricks.append('roll over')
print(d.tricks)  # ['roll over']
print(e.tricks)  # ['roll over']
```

### 3.2 通过实例赋值覆盖类变量（仅对该实例有效）

```python
d.tricks = ['play dead']
print(d.tricks)  # ['play dead']  （实例自己的列表）
print(e.tricks)  # []            （还指向类变量）
print(Dog.tricks)  # []          （类变量没变）
```

**总结：**

- 类变量通过类名或可变对象方法（append/extend）修改 → 所有实例看到变化。
- 实例赋值 → 创建独立实例变量，不影响类或其他实例。

---

## 4. self.tricks 查找规则

1. 访问属性 `self.tricks`：
   - 先看实例是否有该属性。
   - 实例没有 → 查看类是否有该属性。
   - 类也没有 → 报错 `AttributeError`。

2. 赋值属性 `self.tricks = [...]`：
   - 在实例字典中创建或覆盖属性。
   - 不影响类变量或其他实例。

**例子：**

```python
class Dog:
    tricks = []  # 类变量

d = Dog()
e = Dog()

# 给实例赋值一个新的列表
d.tricks = ['play dead']
print(d.tricks)  # ['play dead'] → 实例自己的列表
print(e.tricks)  # [] → 类变量
print(Dog.tricks)  # [] → 类变量
```

**小结：**

| 动作        | 结果 |
|------------|------|
| 访问属性    | 实例优先 → 类 → 父类 → 内置，找不到报错，不创建实例变量 |
| 赋值属性    | 在实例里新建或覆盖，不影响类或其他实例 |

---

## 5. 类比理解

- **类变量 = 公用冰箱**：所有人都能看到和使用，修改会影响别人。
- **实例变量 = 每个人的便当盒**：独立操作，只影响自己。
- 即使名字一样，赋值操作相当于开了自己的便当盒，修改只影响自己。

---

## 6. 总结要点

1. **类变量**：定义在类里，所有实例共享，修改可影响所有实例。
2. **实例变量**：定义在 `__init__` 中，使用 `self.xxx`，每个实例独立。
3. **可变对象当类变量**容易意外共享，应避免。
4. **访问 vs 赋值**:
   - 访问 → 查找，不创建。
   - 赋值 → 在实例中新建或覆盖属性，不影响类。
5. **实例变量可覆盖类变量**：相同名字，但独立存在。

---

**推荐练习**：

- 尝试在实例中修改类变量，观察其他实例的变化。
- 用列表或字典做类变量，看看会不会意外共享。
- 实验 `self.xxx.append()` 和 `self.xxx = [...]` 的区别。

---


