# Python æ•°æ®ç±» (dataclasses) å­¦ä¹ ç¬”è®°

## å¯¹è¯å†…å®¹æ•´ç†

**ç”¨æˆ·ï¼š**

``` python
9.11 dataclassesï¼ˆæ•°æ®ç±»ï¼‰
from dataclasses import dataclass

@dataclass
class Employee:
    name: str
    dept: str
    salary: int

john = Employee('John', 'IT', 1000)
print(john.dept, john.salary)  # IT 1000
```

ç”¨æˆ·ï¼šç”¨äºæ†ç»‘ç›¸å…³æ•°æ®ï¼Œç±»ä¼¼ C è¯­è¨€ structã€‚

ç”¨æˆ·ï¼šè‡ªåŠ¨ç”Ÿæˆ **init**ã€**repr** ç­‰æ–¹æ³•ã€‚ ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

**åŠ©æ‰‹ï¼š** ä½ é—®åˆ° **dataclassesï¼ˆæ•°æ®ç±»ï¼‰** æ—¶æåˆ°çš„
`__init__`ã€`__repr__`ï¼Œæˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ ğŸ‘‡

------------------------------------------------------------------------

## 1. ä»€ä¹ˆæ˜¯ dataclassï¼Ÿ

-   Python çš„ `dataclasses` æ¨¡å—æ˜¯åœ¨ **Python 3.7** å¼•å…¥çš„ã€‚\
-   å®ƒçš„ä½œç”¨æ˜¯ï¼šè®©ä½ å¿«é€Ÿå®šä¹‰
    **ä¸»è¦ç”¨äºå­˜å‚¨æ•°æ®çš„ç±»**ï¼Œè€Œä¸ç”¨è‡ªå·±å»å†™ä¸€å¤§å †æ ·æ¿æ–¹æ³•ã€‚\
-   æœ‰ç‚¹ç±»ä¼¼ **Cè¯­è¨€é‡Œçš„ `struct`**ï¼Œæˆ–è€…å…¶ä»–è¯­è¨€é‡Œçš„ **record / data
    class**ã€‚

------------------------------------------------------------------------

## 2. è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•

å½“ä½ åœ¨ç±»å‰åŠ ä¸Š `@dataclass` è£…é¥°å™¨æ—¶ï¼ŒPython
ä¼š**è‡ªåŠ¨ç”Ÿæˆä¸€äº›å¸¸ç”¨æ–¹æ³•**ï¼ŒåŒ…æ‹¬ï¼š

1.  **`__init__`**\
    è‡ªåŠ¨ç”Ÿæˆåˆå§‹åŒ–å‡½æ•°ï¼ŒæŠŠä½ å£°æ˜çš„å­—æ®µä½œä¸ºå‚æ•°ï¼š

    ``` python
    john = Employee("John", "IT", 1000)
    # ç›¸å½“äºè‡ªåŠ¨ç”Ÿæˆäº†:
    # def __init__(self, name, dept, salary):
    #     self.name = name
    #     self.dept = dept
    #     self.salary = salary
    ```

2.  **`__repr__`**\
    è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª"æ¼‚äº®çš„å­—ç¬¦ä¸²è¡¨ç¤º"ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ‰“å°ï¼š

    ``` python
    print(john)
    # è¾“å‡ºï¼šEmployee(name='John', dept='IT', salary=1000)
    ```

3.  **`__eq__`**\
    è‡ªåŠ¨ç”Ÿæˆæ¯”è¾ƒä¸¤ä¸ªå®ä¾‹æ˜¯å¦ç›¸ç­‰çš„æ–¹æ³•ï¼ˆå­—æ®µé€ä¸€æ¯”è¾ƒï¼‰ï¼š

    ``` python
    e1 = Employee("John", "IT", 1000)
    e2 = Employee("John", "IT", 1000)
    print(e1 == e2)  # True
    ```

4.  **å…¶ä»–å¯é€‰æ–¹æ³•**ï¼ˆå–å†³äºå‚æ•°è®¾ç½®ï¼‰

    -   `__lt__`ã€`__le__`ã€`__gt__`ã€`__ge__`ï¼šæ’åºæ¯”è¾ƒ\
    -   `__hash__`ï¼šå¯è®©å¯¹è±¡ç”¨ä½œå­—å…¸ key

------------------------------------------------------------------------

## 3. ä½ çš„ä¾‹å­æ‹†è§£

``` python
from dataclasses import dataclass

@dataclass
class Employee:
    name: str
    dept: str
    salary: int

john = Employee('John', 'IT', 1000)
print(john.dept, john.salary)  # IT 1000
print(john)                    # Employee(name='John', dept='IT', salary=1000)
```

ç­‰ä»·äºæ‰‹åŠ¨å†™çš„ç±»ï¼š

``` python
class Employee:
    def __init__(self, name: str, dept: str, salary: int):
        self.name = name
        self.dept = dept
        self.salary = salary

    def __repr__(self):
        return f"Employee(name={self.name!r}, dept={self.dept!r}, salary={self.salary!r})"

    def __eq__(self, other):
        if isinstance(other, Employee):
            return (self.name, self.dept, self.salary) == (other.name, other.dept, other.salary)
        return NotImplemented
```

------------------------------------------------------------------------

## 4. å¸¸ç”¨è¿›é˜¶åŠŸèƒ½

-   é»˜è®¤å€¼ï¼š

    ``` python
    @dataclass
    class Employee:
        name: str
        dept: str = "IT"   # é»˜è®¤å€¼
        salary: int = 5000
    ```

-   ä¸å¯å˜å¯¹è±¡ï¼ˆç±»ä¼¼ tupleï¼‰ï¼š

    ``` python
    @dataclass(frozen=True)
    class Point:
        x: int
        y: int
    p = Point(1, 2)
    # p.x = 3  # âŒ ä¼šæŠ¥é”™ï¼Œå› ä¸º frozen=True
    ```

-   æ’åºï¼š

    ``` python
    @dataclass(order=True)
    class Employee:
        salary: int
        name: str
    e1 = Employee(1000, "Alice")
    e2 = Employee(2000, "Bob")
    print(e1 < e2)  # True
    ```

------------------------------------------------------------------------

## 5. dataclass å‚æ•°å¯¹æ¯”è¡¨

  ---------------------------------------------------------------------------
  å‚æ•°                    ä½œç”¨                    ç¤ºä¾‹
  ----------------------- ----------------------- ---------------------------
  `init`                  æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ `__init__` `@dataclass(init=False)`

  `repr`                  æ˜¯å¦è‡ªåŠ¨ç”Ÿæˆ `__repr__` `@dataclass(repr=False)`

  `eq`                    æ˜¯å¦ç”Ÿæˆ `__eq__` æ–¹æ³•  `@dataclass(eq=False)`

  `order`                 æ˜¯å¦ç”Ÿæˆæ’åºæ¯”è¾ƒæ–¹æ³•    `@dataclass(order=True)`

  `frozen`                æ˜¯å¦ä¸å¯å˜              `@dataclass(frozen=True)`

  `slots` (Python 3.10+)  æ˜¯å¦ä½¿ç”¨ `__slots__`    `@dataclass(slots=True)`
                          èŠ‚çœå†…å­˜                
  ---------------------------------------------------------------------------

------------------------------------------------------------------------

## æ€»ç»“

-   `@dataclass` è®©æˆ‘ä»¬å¯ä»¥å¿«é€Ÿå®šä¹‰"æ•°æ®å­˜å‚¨ç±»"ï¼Œé¿å…å†™é‡å¤ä»£ç ã€‚\
-   é»˜è®¤ä¼šç”Ÿæˆ
    `__init__`ã€`__repr__`ã€`__eq__`ï¼Œè¿˜èƒ½é€šè¿‡å‚æ•°æ§åˆ¶æ›´å¤šåŠŸèƒ½ã€‚\
-   é€‚åˆç”¨æ¥æè¿° **ä¸»è¦ç”¨äºå­˜å‚¨æ•°æ®ã€é€»è¾‘ä¸å¤æ‚çš„ç±»**ã€‚
